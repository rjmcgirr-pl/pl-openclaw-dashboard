name = "taskboard-api"
main = "src/index.ts"
compatibility_date = "2024-12-30"
account_id = "926b4147f0c4510a15a7fd4cb409b0d8"

# Observability - Enable logs for debugging
[observability]
[observability.logs]
enabled = true
invocation_logs = true

# Durable Objects for SSE Connection Management
[[durable_objects.bindings]]
name = "SSE_CONNECTION_MANAGER"
class_name = "SSEConnectionManager"

# Durable Object migration - create the namespace
[[migrations]]
tag = "v1"
new_classes = ["SSEConnectionManager"]

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "openclaw-taskboard-db"
database_id = "826b8608-1376-476a-924a-bdd542ff8b45"

# KV Namespace for Cron Jobs (named pl-openclaw-dashboard in Cloudflare)
[[kv_namespaces]]
binding = "CRON_JOBS_KV"
id = "dc82acf0e2dd40fd8f63e378d1b736be"

# KV Namespace for Session Storage
[[kv_namespaces]]
binding = "SESSION_KV"
id = "a25297fb8b76435ba06747f2e9417c62"

# Environment variables
[vars]
# Set this to your Cloudflare Pages domain in production
# ALLOWED_ORIGIN = "https://taskboard.pages.dev"
# Google OAuth configuration
GOOGLE_CLIENT_ID = "placeholder"
ALLOWED_DOMAIN = "propertyllama.com"
# Agent API Key for automation (set via wrangler secret)
AGENT_API_KEY = "set-via-secret"

# Secrets - set via: wrangler secret put NAME --env production
# GOOGLE_CLIENT_SECRET - Google OAuth client secret (required for OAuth flow)

# For local development
[env.local]
vars = { ALLOWED_ORIGIN = "http://localhost:8788", GOOGLE_CLIENT_ID = "placeholder", ALLOWED_DOMAIN = "propertyllama.com", AGENT_API_KEY = "local-dev-key", JWT_SECRET = "local-dev-secret" }

[[env.local.d1_databases]]
binding = "DB"
database_name = "openclaw-taskboard-db"
database_id = "826b8608-1376-476a-924a-bdd542ff8b45"

[[env.local.kv_namespaces]]
binding = "CRON_JOBS_KV"
id = "dc82acf0e2dd40fd8f63e378d1b736be"

[[env.local.kv_namespaces]]
binding = "SESSION_KV"
id = "a25297fb8b76435ba06747f2e9417c62"

[[env.local.durable_objects.bindings]]
name = "SSE_CONNECTION_MANAGER"
class_name = "SSEConnectionManager"

# Staging environment
[env.staging]
name = "taskboard-api-staging"
vars = { ALLOWED_ORIGIN = "https://dev.openclaw.propertyllama.com", GOOGLE_CLIENT_ID = "placeholder", ALLOWED_DOMAIN = "propertyllama.com", AGENT_API_KEY = "set-via-secret", JWT_SECRET = "set-via-secret" }

[[env.staging.d1_databases]]
binding = "DB"
database_name = "openclaw-taskboard-db-staging"
database_id = "7114d7e5-d638-49ad-a643-f606676be6d2"

[[env.staging.kv_namespaces]]
binding = "CRON_JOBS_KV"
id = "dc82acf0e2dd40fd8f63e378d1b736be"

[[env.staging.kv_namespaces]]
binding = "SESSION_KV"
id = "a25297fb8b76435ba06747f2e9417c62"

# Durable Objects for SSE Connection Management (must be defined per environment)
[[env.staging.durable_objects.bindings]]
name = "SSE_CONNECTION_MANAGER"
class_name = "SSEConnectionManager"

# Production environment
[env.production]
name = "taskboard-api"
vars = { ALLOWED_ORIGIN = "https://openclaw.propertyllama.com", GOOGLE_CLIENT_ID = "placeholder", ALLOWED_DOMAIN = "propertyllama.com", AGENT_API_KEY = "set-via-secret" }

[[env.production.d1_databases]]
binding = "DB"
database_name = "openclaw-taskboard-db"
database_id = "826b8608-1376-476a-924a-bdd542ff8b45"

[[env.production.kv_namespaces]]
binding = "CRON_JOBS_KV"
id = "dc82acf0e2dd40fd8f63e378d1b736be"

[[env.production.kv_namespaces]]
binding = "SESSION_KV"
id = "a25297fb8b76435ba06747f2e9417c62"

# Durable Objects for SSE Connection Management (must be defined per environment)
[[env.production.durable_objects.bindings]]
name = "SSE_CONNECTION_MANAGER"
class_name = "SSEConnectionManager"
